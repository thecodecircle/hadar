var map = L.map("map", {
center: [32.813764236164246, 34.99735056504973],
zoom: 13
});
var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
maxZoom: 19,
attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
});
OpenStreetMap_Mapnik.addTo(map);
<% events = Event.where(status: :approved).order(created_at: :desc) %>
let marker;
<% events.each do |event| %>
  marker = L.marker([<%= event.lat %>, <%= event.long %>]).addTo(map);
  marker.bindPopup("<%= event.date.strftime("%d/%m") %> | <%= event.time.strftime("%H:%M") %>: <%= event.description %>").openPopup();
<% end %>
function onLocationFound(e) {
var radius = e.accuracy;
L.marker(e.latlng).addTo(map)
.bindPopup("אתםן נמצאים ברדיוס של" + radius + " מטר מהנקודה הזו").openPopup();
L.circle(e.latlng, radius).addTo(map);
}
function onLocationError(e) {
alert("למה לא לתת לנו את המיקום? אנחנו מאוד נחמדים, ושום מידע לא מגיע לצוקרברג המניאק");
}
var popup = L.popup();
function onMapClick(e) {
var httpRequest = new XMLHttpRequest()
var url = "https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=" + e.latlng.lat + "&lon=" + e.latlng.lng
httpRequest.open('GET', url)
httpRequest.send()
var address = {}
httpRequest.onreadystatechange = function (data) {
address = JSON.parse(httpRequest.response).address
console.log(address.road);
popup
.setLatLng(e.latlng)
.setContent("<a href='/events/new?lat=" + e.latlng.lat + "&lng=" + e.latlng.lng + "&street=" + address.road + "'>דיווח על אירוע ב" + address.road + "</a>")
.openOn(map);
}
}
map.on('click', onMapClick);
map.on('locationfound', onLocationFound);
map.on('locationerror', onLocationError);
map.locate({setView: true, maxZoom: 16});
