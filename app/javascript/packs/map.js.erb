var map = L.map("map", {
center: [32.813764236164246, 34.99735056504973],
zoom: 13
});
// L.tileLayer.provider('OpenStreetMap.Mapnik').addTo(map);
var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
maxZoom: 19,
attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
});
OpenStreetMap_Mapnik.addTo(map);
// L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
//     attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
//     maxZoom: 18,
//     id: 'mapbox/streets-v11',
//     tileSize: 512,
//     zoomOffset: -1,
//     accessToken: 'pk.eyJ1IjoiY29kZS1jaXJjbGUiLCJhIjoiY2tvcHVhN25iMG93aDJ2c2o3dTl5YnZ1diJ9.Rvm7HGxwSnjLs6bYKswCIg'
// }).addTo(map);
// var map = L.map('map').fitWorld();
// L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={pk.eyJ1IjoiY29kZS1jaXJjbGUiLCJhIjoiY2tvcHVhN25iMG93aDJ2c2o3dTl5YnZ1diJ9.Rvm7HGxwSnjLs6bYKswCIg}', {
//     attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
//     maxZoom: 18,
//     tileSize: 512,
//     zoomOffset: -1
// }).addTo(map);
// L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
//     attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
//     maxZoom: 18,
//     id: 'mapbox/streets-v11',
//     tileSize: 512,
//     zoomOffset: -1,
//     accessToken: 'pk.eyJ1IjoiY29kZS1jaXJjbGUiLCJhIjoiY2tvcHVhN25iMG93aDJ2c2o3dTl5YnZ1diJ9.Rvm7HGxwSnjLs6bYKswCIg'
// }).addTo(map);
<% events = Event.where(status: :approved).order(created_at: :desc) %>
let marker;
<% events.each do |event| %>
  marker = L.marker([<%= event.lat %>, <%= event.long %>]).addTo(map);
  marker.bindPopup("<%= event.date.strftime("%d/%m") %> | <%= event.time.strftime("%H:%M") %>: <%= event.description %>").openPopup();
<% end %>
function onLocationFound(e) {
var radius = e.accuracy;
L.marker(e.latlng).addTo(map)
.bindPopup("You are within " + radius + " meters from this point").openPopup();
L.circle(e.latlng, radius).addTo(map);
}
function onLocationError(e) {
alert(e.message);
}
var popup = L.popup();
function onMapClick(e) {
var httpRequest = new XMLHttpRequest()
var url = "https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=" + e.latlng.lat + "&lon=" + e.latlng.lng
httpRequest.open('GET', url)
httpRequest.send()
var address = {}
httpRequest.onreadystatechange = function (data) {
address = JSON.parse(httpRequest.response).address
console.log(address.road);
popup
.setLatLng(e.latlng)
// .setContent("You clicked the map at " + e.latlng.toString())
.setContent("<a href='/events/new?lat=" + e.latlng.lat + "&lng=" + e.latlng.lng + "&street=" + address.road + "'>דיווח על אירוע ב" + address.road + "</a>")
.openOn(map);
}
}
map.on('click', onMapClick);
map.on('locationfound', onLocationFound);
map.on('locationerror', onLocationError);
map.locate({setView: true, maxZoom: 16});
